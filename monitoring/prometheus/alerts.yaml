groups:
- name: bms_alerts
  interval: 10s
  rules:

  - alert: ServiceDown
    expr: up{job="bms-backend"} == 0
    for: 15s
    labels:
      severity: critical
    annotations:
      summary: "๐ฅ Backend ัะฟะฐะป ะธ ะฝะต ะฒััะฐัั!"
      description: "๐ฑ ะกะตัะฒะธั bms-backend ะฝะตะดะพัััะฟะตะฝ ัะถะต 15 ัะตะบัะฝะด!\n\nPrometheus ะฝะต ะผะพะถะตั ัะพะฑัะฐัั ะผะตััะธะบะธ.\nะะตัะพััะฝะพ, ะบัะพ-ัะพ ัะปััะฐะนะฝะพ ัะดะฐะปะธะป production ะฑะฐะทั ะดะฐะฝะฝัั ๐คฆ\nะธะปะธ ะฝะฐะถะฐะป Ctrl+C ะฒ production (ะบะปะฐััะธะบะฐ) ๐\n\nะะะะ ะคะะะกะะขะฌ! ๐๐จ\nP.S. ะะฐะดะตััั ั ัะตะฑั ะตััั ะฑัะบะฐะฟ... ๐ค"

  - alert: High5xxErrorRate
    expr: |
      (
        sum(rate(http_requests_total{job="bms-backend",status=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{job="bms-backend"}[5m]))
      ) > 0.05
      and
      sum(rate(http_requests_total{job="bms-backend"}[5m])) > 1
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "๐ฅ ะกะตัะฒะตั ะฟะปััััั ะพัะธะฑะบะฐะผะธ 5XX!"
      description: "๐จ ะะพะปะตะต 5% ะทะฐะฟัะพัะพะฒ ะฒะพะทะฒัะฐัะฐัั 5XX ะพัะธะฑะบะธ ัะถะต 30 ัะตะบัะฝะด!\n\nะะพัะพะถะต, ะฑะฐะทะฐ ะดะฐะฝะฝัั ัะตัะธะปะฐ ะฒะทััั ะพัะฟััะบ ๐๏ธ\nะธะปะธ ะบะพะด ะฝะฐะฟะธัะฐะฝ ะฝะฐ PHP ๐ฑ\nะธะปะธ ะบัะพ-ัะพ ะดะตะฟะปะพะธั ะฒ ะฟััะฝะธัั ะฒะตัะตัะพะผ (ะพะฟััั!) ๐ป\n\nะัะพะฒะตัั ะปะพะณะธ, ะฒะพะทะผะพะถะฝะพ ัะฐะผ ะตััั ะฟะพะดัะบะฐะทะบะธ (ะธะปะธ ะฝะตั) ๐คท\nะะพะถะตั ะฑััั ะฟัะพััะพ ะฟะตัะตะทะฐะฟัััะธ ะธ ะฟะพะผะพะปะธัั? ๐"

  - alert: High4xxErrorRate
    expr: |
      (
        sum(rate(http_requests_total{job="bms-backend",status=~"4.."}[5m]))
        /
        sum(rate(http_requests_total{job="bms-backend"}[5m]))
      ) > 0.10
      and
      sum(rate(http_requests_total{job="bms-backend"}[5m])) > 1
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "โ๏ธ ะะปะธะตะฝัั ะฝะต ะผะพะณัั ะฟะพะฟะฐััั ะบัะดะฐ ะฝัะถะฝะพ"
      description: "๐ค ะะพะปะตะต 10% ะทะฐะฟัะพัะพะฒ ะฒะพะทะฒัะฐัะฐัั 4XX ะพัะธะฑะบะธ ัะถะต ะผะธะฝััั.\n\nะะพะทะผะพะถะฝะพ:\n- API ะธะทะผะตะฝะธะปะธ, ะฐ ะดะพะบัะผะตะฝัะฐัะธั ะทะฐะฑัะปะธ ๐\n- ะะปะธะตะฝัั ะฟััะฐัััั ะทะฐะนัะธ ััะดะฐ, ะบัะดะฐ ะฝะตะปัะทั ๐ซ\n- ะัะพ-ัะพ ัะตััะธััะตั ะฑะตะทะพะฟะฐัะฝะพััั (ะธะปะธ ะฟัะพััะพ ะปะพะผะฐะตั) ๐ต๏ธ\n- ะคัะพะฝัะตะฝะด ัะฐะทัะฐะฑะพััะธะบ ะพะฟััั ััะพ-ัะพ ัะปะพะผะฐะป ๐จ\n\nะัะพะฒะตัั ััะพ ะฟัะพะธััะพะดะธั, ะฝะพ ะฝะต ะฟะฐะฝะธะบัะน (ะฟะพะบะฐ) ๐\nะญัะพ ะฝะต ะบัะธัะธัะฝะพ, ะฝะพ ะธ ะฝะต ัะพัะพัะพ ๐คท"

  - alert: SlowAPIResponse
    expr: |
      histogram_quantile(
        0.95,
        sum(rate(http_request_duration_seconds_bucket{job="bms-backend"}[5m]))
        by (le)
      ) > 1
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "๐ API ัะฐะฑะพัะฐะตั ะบะฐะบ ัะปะธัะบะฐ"
      description: "โฑ๏ธ p95 latency ะฟัะตะฒััะฐะตั 1 ัะตะบัะฝะดั ัะถะต ะผะธะฝััั!\n\nะะฐะฟัะพัั ะพะฑัะฐะฑะฐััะฒะฐัััั ะผะตะดะปะตะฝะฝะตะต, ัะตะผ ัะตัะตะฟะฐัะฐ ะฑะตะถะธั ๐ข\n\nะะพะทะผะพะถะฝัะต ะฟัะธัะธะฝั:\n- ะะฐะทะฐ ะดะฐะฝะฝัั ะดัะผะฐะตั ะพ ัะผััะปะต ะถะธะทะฝะธ ๐ค\n- ะัะพ-ัะพ ะทะฐะฟัััะธะป SELECT * FROM users ะฝะฐ ะผะธะปะปะธะพะฝะต ะทะฐะฟะธัะตะน ๐\n- ะกะตัะฒะตั ัะตัะธะป ะฟะพัะฟะฐัั ๐ด\n- N+1 ะทะฐะฟัะพัะพะฒ (ะพะฟััั!) ๐\n\nะะพัะฐ ะพะฟัะธะผะธะทะธัะพะฒะฐัั ะธะปะธ ะดะพะฑะฐะฒะธัั ะบะพัะต โ\nะะปะธ ะฟัะพััะพ ะฟะพะดะพะถะดะฐัั, ะผะพะถะตั ัะฐะผะพ ะฟัะพะนะดัั? ๐ค"

  - alert: TrafficDrop
    expr: sum(rate(http_requests_total{job="bms-backend"}[5m])) < 1
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "๐ ะขัะฐัะธะบ ัะฟะฐะป ะฝะธะถะต ะฟะปะธะฝัััะฐ"
      description: "๐ด ะะตะฝััะต 1 ะทะฐะฟัะพัะฐ ะฒ ัะตะบัะฝะดั ัะถะต 2 ะผะธะฝััั.\n\nะะธะฑะพ:\n- ะัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ััะปะธ ะฒ ะพัะฟััะบ ๐๏ธ\n- ะัะพ-ัะพ ะทะฐะฑัะป ะฟัะพะดะปะธัั ะดะพะผะตะฝ ๐ธ\n- ะกะตัะฒะธั ัะฐะฑะพัะฐะตั ัะฐะบ ัะพัะพัะพ, ััะพ ะฝะธะบัะพ ะฝะต ะถะฐะปัะตััั (ะผะฐะปะพะฒะตัะพััะฝะพ) ๐คท\n- ะัะต ะฟะตัะตัะปะธ ะฝะฐ ะบะพะฝะบััะตะฝัะพะฒ ๐ฑ\n\nะัะพะฒะตัั ััะพ ะฒัั ะพะบ, ะธะปะธ ะฟัะพััะพ ะฝะฐัะปะฐะถะดะฐะนัั ัะธัะธะฝะพะน ๐ง\nะะพะถะตั ะฑััั ััะพ ัะพัะพัะพ? ๐ค"

  # - alert: BackendPanic
  #   expr: increase(panic_total{job="bms-backend"}[5m]) > 0
  #   for: 0m
  #   labels:
  #     severity: critical
  #   annotations:
  #     summary: "๐ Backend ะฟะฐะฝะธะบัะตั!"
  #     description: "๐จ ะะฑะฝะฐััะถะตะฝ panic ะฒ backend!\n\nะะพะด ัะตัะธะป ััะพ ะถะธะทะฝั ัะปะธัะบะพะผ ัะปะพะถะฝะฐ ะธ ัะฟะฐะป ะฒ ะพะฑะผะพัะพะบ ๐\n\nะญัะพ ะบัะธัะธัะฝะพ! ะกะบะพัะตะต ะฒัะตะณะพ:\n- nil pointer dereference (ะบะปะฐััะธะบะฐ) ๐ฏ\n- ะัะพ-ัะพ ะทะฐะฑัะป ะพะฑัะฐะฑะพัะฐัั ะพัะธะฑะบั ๐ฑ\n- Go ัะตัะธะป ััะพ ะฟะพัะฐ ะฝะฐ ะฟะตะฝัะธั ๐๏ธ\n- ะะตะปะตะฝะธะต ะฝะฐ ะฝะพะปั (ะผะฐัะตะผะฐัะธะบะฐ ัะปะพะถะฝะฐั) โ\n\nะกะะะงะะ ัะผะพััะธ ะปะพะณะธ ะธ ัะธะบัะธ! ๐๐จ\nะ ะฒ ัะปะตะดัััะธะน ัะฐะท ะฟะธัะธ ัะตััั! ๐งช"
