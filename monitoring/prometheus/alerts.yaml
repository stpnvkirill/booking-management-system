groups:
- name: bms_alerts
  interval: 10s
  rules:

  - alert: ServiceDown
    expr: up{job="bms-backend"} == 0
    for: 15s
    labels:
      severity: critical
    annotations:
      summary: "üî• Backend —É–ø–∞–ª –∏ –Ω–µ –≤—Å—Ç–∞—ë—Ç!"
      description: "üò± –°–µ—Ä–≤–∏—Å bms-backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —É–∂–µ 15 —Å–µ–∫—É–Ω–¥!\n\nPrometheus –Ω–µ –º–æ–∂–µ—Ç —Å–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏.\n–í–µ—Ä–æ—è—Ç–Ω–æ, —á—Ç–æ –∫—Ç–æ-—Ç–æ —á—É—Ç–∫–∞ –ø–µ—Ä–µ—Å—Ç–∞—Ä–∞–ª—Å—è... \n\n–†–∞—Å—á–µ—Ö–ª—è–π –±—ç–∫–∞–ø—á–∏–∫ –±—Ä–∞—Ç–∞–Ω—á–∏–∫)"
      resolved_description: "üéâ –°–µ—Ä–¥—Ü–µ –≤–Ω–æ–≤—å –∑–∞–±–∏–ª–æ—Å—å! –ü—Ä–∏—Å—Ç–∏–≥–Ω–∏—Ç–µ—Å—å, –º—ã –≤–∑–ª–µ—Ç–∞–µ–º! –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."

  - alert: DatabaseDown
    expr: pg_up == 0
    for: 15s
    labels:
      severity: critical
    annotations:
      summary: "üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π: –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–ø–∞–ª–∞!"
      description: "üò± –°–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ PostgreSQL —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–ª—å –≤ —Ç–µ—á–µ–Ω–∏–µ 15 —Å–µ–∫—É–Ω–¥.\n"
      resolved_description: "üéâ –°–µ—Ä–¥—Ü–µ –≤–Ω–æ–≤—å –∑–∞–±–∏–ª–æ—Å—å! –ü—Ä–∏—Å—Ç–∏–≥–Ω–∏—Ç–µ—Å—å, –º—ã –≤–∑–ª–µ—Ç–∞–µ–º! –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."

  - alert: PostgresExporterDown
    expr: up{job="bms-db"} == 0
    for: 15s
    labels:
      severity: critical
    annotations:
      summary: "üî• bms-postgres-exporter —É–ø–∞–ª –∏ –Ω–µ –≤—Å—Ç–∞—ë—Ç!"
      description: "üò± –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Å–ª–µ–ø–ª–∞. –ù–∞—à –±—Ä–∞—Ç bms-postgres-exporter –ø–µ—Ä–µ—Å—Ç–∞–ª –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã Prometheus."
      resolved_description: "üéâ Backend bms-backend —Å–Ω–æ–≤–∞ –≤ —Å–µ—Ç–∏, –≤—Å—ë –≥—É–¥!"

  - alert: High5xxErrorRate
    expr: |
      (
        sum(rate(http_requests_total{job="bms-backend",status=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{job="bms-backend"}[5m]))
      ) > 0.05
      and
      sum(rate(http_requests_total{job="bms-backend"}[5m])) > 1
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "üí•–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ 5XX –≤ —Å–µ—Ä–≤–∏—Å–µ \n–°–µ—Ä–≤–µ—Ä –ø–ª—é—ë—Ç—Å—è –æ—à–∏–±–∫–∞–º–∏ 5XX!"
      description: "üö® –ë–æ–ª–µ–µ 5% –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 5XX –æ—à–∏–±–∫–∏ —É–∂–µ 30 —Å–µ–∫—É–Ω–¥!\n\n–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã."
      resolved_description: "üéâ Backend bms-backend —Å–Ω–æ–≤–∞ –≤ —Å–µ—Ç–∏, –≤—Å—ë –≥—É–¥!"

  - alert: High4xxErrorRate
    expr: |
      (
        sum(rate(http_requests_total{job="bms-backend",status=~"4.."}[5m]))
        /
        sum(rate(http_requests_total{job="bms-backend"}[5m]))
      ) > 0.10
      and
      sum(rate(http_requests_total{job="bms-backend"}[5m])) > 1
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "‚ö†Ô∏è–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫ 4XX –≤ —Å–µ—Ä–≤–∏—Å–µ! \n–ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –ø–æ–ø–∞—Å—Ç—å –∫—É–¥–∞ –Ω—É–∂–Ω–æ"
      description: "ü§î –ë–æ–ª–µ–µ 10% –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 4XX –æ—à–∏–±–∫–∏ —É–∂–µ –º–∏–Ω—É—Ç—É.\n\n–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏."
      resolved_description: "üéâ Backend bms-backend —Å–Ω–æ–≤–∞ –≤ —Å–µ—Ç–∏, –≤—Å—ë –≥—É–¥!"

  - alert: SlowAPIResponse
    expr: |
      histogram_quantile(
        0.95,
        sum(rate(http_request_duration_seconds_bucket{job="bms-backend"}[5m]))
        by (le)
      ) > 1
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "–í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤! \nüêå API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —É–ª–∏—Ç–∫–∞"
      description: "‚è±Ô∏è 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–∏—Å–∞ bms-backend –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1 —Å–µ–∫—É–Ω–¥—É –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã."
      resolved_description: "üéâ Backend bms-backend —Å–Ω–æ–≤–∞ –≤ —Å–µ—Ç–∏, –≤—Å—ë –≥—É–¥!"

  - alert: TrafficDrop
    expr: sum(rate(http_requests_total{job="bms-backend"}[5m])) < 1
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "üìâ –ê–Ω–æ–º–∞–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ bms-backend"
      description: "üò¥ –°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å—É bms-backend —É–ø–∞–ª–∞ –Ω–∏–∂–µ 1 –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥—É –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –º–∏–Ω—É—Ç. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–µ—Ç–µ–≤—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏."
      resolved_description: "üéâ Backend bms-backend —Å–Ω–æ–≤–∞ –≤ —Å–µ—Ç–∏, –≤—Å—ë –≥—É–¥!"

  # - alert: BackendPanic
  #   expr: increase(panic_total{job="bms-backend"}[5m]) > 0
  #   for: 0m
  #   labels:
  #     severity: critical
  #   annotations:
  #     summary: "üíÄ Backend –ø–∞–Ω–∏–∫—É–µ—Ç!"
  #     description: "üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω panic –≤ backend!\n\n–ö–æ–¥ —Ä–µ—à–∏–ª —á—Ç–æ –∂–∏–∑–Ω—å —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞ –∏ —É–ø–∞–ª –≤ –æ–±–º–æ—Ä–æ–∫ üíÄ\n\n–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ! –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ:\n- nil pointer dereference (–∫–ª–∞—Å—Å–∏–∫–∞) üéØ\n- –ö—Ç–æ-—Ç–æ –∑–∞–±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É üò±\n- Go —Ä–µ—à–∏–ª —á—Ç–æ –ø–æ—Ä–∞ –Ω–∞ –ø–µ–Ω—Å–∏—é üèñÔ∏è\n- –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å (–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Å–ª–æ–∂–Ω–∞—è) ‚ûó\n\n–°–†–û–ß–ù–û —Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –∏ —Ñ–∏–∫—Å–∏! üèÉüí®\n–ò –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –ø–∏—à–∏ —Ç–µ—Å—Ç—ã! üß™"
